<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="~{layout/cli_layout}">

<th:block layout:fragment="content">

    <t-h1 en="LEAGUE" ko="ë¦¬ê·¸"></t-h1>

    <t-h2 th:ko="${l.leagueVO.leagueName}"></t-h2>
    <h3 class="h3">ë¦¬ê·¸ ì •ë³´</h3>
    <table class="table">
        <tbody>
            <tr>
                <td>
                    <span th:text="${l.leagueVO.leagueId}"></span><br>
                    <convert-c-code th:data="${l.leagueVO.leagueStatusCd}"></convert-c-code><br>
                    <span th:text="${#dates.format(l.leagueVO.startDate, 'yyyy-MM-dd') + ' - ' + #dates.format(l.leagueVO.endDate, 'yyyy-MM-dd')}">ì‹œì‘ì¼</span><br>
                    <span>ìƒê¸ˆ : </span><span th:text="${l.leagueVO.prizeMoney}">ìƒê¸ˆ</span><br>
                    <span th:text="${'ì°¸ê°€ë¹„ : ' + l.leagueVO.entryFee}">ì°¸ê°€ë¹„</span><br>
<!--                    <span th:text="${'ìŠ¹ë¦¬íŒ€ : ' + l.leagueVO.winningTeam}">ìŠ¹ë¦¬íŒ€</span><br>-->
                </td>
            </tr>
            <tr>
                <!-- íŒ€ì´ ì—†ëŠ” ê²½ìš° -->
                <td th:if="${l.loginedMember.getTeamId() == 0}">
                    <h3 class="h3">ë‚˜ì˜ íŒ€</h3>
                    <div class="message-caution">
                        ì†Œì† íŒ€ì´ ì—†ìŠµë‹ˆë‹¤.<br>
                        <span>ğŸ“¢íŒ€ì„ ìƒì„±í•˜ì…”ì•¼ ë¦¬ê·¸ì— ì°¸ê°€í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</span>
                    </div>
                    <div class="button__box">
                        <a class="c-button" href="">íŒ€ ìƒì„±</a>
                    </div>
                </td>

                <!-- íŒ€ì´ ìˆëŠ” ê²½ìš° -->
                <td th:if="${l.loginedMember.getTeamId() != 0}">
                    <!-- ì„¸ì…˜ì„ í†µí•´ íŒ€ ì¡°íšŒ, ì—†ìœ¼ë©´ íŒ€ìƒì„± ë²„íŠ¼ -->
                    <h3 class="h3">ë‚˜ì˜ íŒ€</h3>
<!--                    <span th:text="${l.teamVO.getTeamId()}">íŒ€ì•„ì´ë””</span><br>-->
                    <div class="row">
                        <div class="col-6">
                            <h4 class="h4" th:text="${'[íŒ€ëª…] ' + l.teamVO.getTeamName()}">íŒ€ì´ë¦„</h4>
                        </div>
                        <div class="col-6">
                            <h4 class="h4" th:text="${'[íŒ€ì¥] ' + l.teamVO.getLeader()}">íŒ€ì¥</h4>
                        </div>
                    </div>

                    <hr>
<!--                    <span th:text="${l.teamVO.getTotalGameCnt()}">íŒ€ ê²Œì„ìˆ˜</span><br>-->
<!--                    <span th:text="${l.teamVO.getWin()}">íŒ€ ìŠ¹ìˆ˜</span>-->

                    <!-- íŒ€ì´ ìˆìœ¼ë©´ íŒ€ì› option ìƒì„± í›„ select ì— append -->
                    <h3 class="h3" th:data="${l.leagueVO.getParticipationMember()}" id="sm">íŒ€ì› ì„ íƒ</h3>
                    <form method="post" id="leagueSubmitFrm" action="/cli/leagueApply">
                        <input type="hidden" th:value="${l.leagueVO.getLeagueId()}" name="lno">
                        <input type="hidden" value="" id="formVal" name="formVal">
                        <div class="row " id="outputSelect">
                            <div class="col-12">
                                <span>ğŸ 1ë²ˆ íƒ€ì</span>
                                <select name="fs0" id="fs0" class="form-control"  >
                                    <option th:each="members, status: ${l.teamMembers}" th:text="${members.getMemberId()}" th:value="${members.getMemberId()}"></option>
                                </select>
                            </div>
                        </div>
                    </form>

                    <div class="button__box mt20">
                        <button class="c-button" onclick="leagueSubmit()" >ì°¸ê°€í•˜ê¸°</button>
                    </div>
<!--                    th:href="${'/cli/leagueApply?lno=' + l.leagueVO.getLeagueId()}"-->
                </td>

            </tr>
        </tbody>
    </table>

    <script>

        $.fn.serializeObject = function() {
            "use strict"
            var result = {}
            var extend = function(i, element) {
                var node = result[element.name]
                if ("undefined" !== typeof node && node !== null) {
                    if ($.isArray(node)) {
                        node.push(element.value)
                    } else {
                        result[element.name] = [node, element.value]
                    }
                } else {
                    result[element.name] = element.value
                }
            }

            $.each(this.serializeArray(), extend)
            return result
        }

        if(document.querySelector('#sm') != undefined) {
            console.log(document.querySelector('#sm').getAttribute('data'))
            let cnt = document.querySelector('#sm').getAttribute('data')
            let s = document.querySelector('#outputSelect')
            let fs = document.querySelector('#fs0')
            let fsCnt = document.querySelector('#fs0').children.length
            let fsArr = document.querySelector('#fs0').children // íŒ€ì— ì†í•œ ë©¤ë²„ ìˆ˜, array ë°˜í™˜

            let valArr = []
            for(let i =0; i < fsCnt; i++) {
                valArr.push(fsArr[i].getAttribute('value'))
            }
            console.log(valArr)

            for(let i=0; i < cnt-1; i++ ) {
               let col = document.createElement('div');
               col.setAttribute('class', 'col-12 mt12')

               let span = document.createElement('span')
               span.innerText = 'ğŸ' + (i+2) + 'ë²ˆ íƒ€ì';

              let sel = fs.cloneNode(true);
               sel.id = 'fs'+(i+1);
               sel.setAttribute('name', 'fs'+(i+1));
               col.append(span, sel)
               s.append(col);
            }

        }

        function leagueSubmit() {
            let arr = []
            let fsCnt = document.querySelector('#fs0').children.length

            let data = document.querySelector('#leagueSubmitFrm')
            console.log( JSON.stringify( $('#leagueSubmitFrm').serializeArray() ) )

            let input = JSON.stringify( $('#leagueSubmitFrm').serializeArray() );
            document.querySelector('#formVal').setAttribute('value', input);

            data.submit()
        }


    </script>


</th:block>

</html>